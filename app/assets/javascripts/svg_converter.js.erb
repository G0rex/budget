$(document).bind('page:change', function(e) {

    d3.select("#save").on("click", function() {
        var html = d3.select("#chart").node().innerHTML.split('</svg>')[0] + "</svg>";

        //console.log(html);
        var imgsrc = 'data:image/svg+xml;base64,' + window.btoa(html);
        //var imgsrc = "<%= asset_path('smile.png') %>";
        var img = '<img src="' + imgsrc + '">';
        d3.select("#svgdataurl").html(img);

        var canvas = document.querySelector("canvas");
        var context = canvas.getContext("2d");

        var img_png = new Image();
        img_png.src = imgsrc;
        img_png.onload = img_load();
        function img_load() {
            context.drawImage(img_png, 0, 0);
            var canvasdata = canvas.toDataURL("image/png");
            console.log(canvasdata);
            var pngimg = '<img src="'+canvasdata+'">';
            d3.select("#pngdataurl").html(pngimg);

            //img_png.src = imgsrc;
            var a = document.createElement("a");
            a.download = "sample.png";
            a.href = canvasdata;
            a.click();
        }
    })

})