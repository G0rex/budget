// Scripts for embed code blocks

$(document).on('ready page:change', function() {

    I18n.locale = window.aHelper.lang();

    // show/hide field with embed code
    $('.btn_embed').click(function (e) {
        if($(this).hasClass("active")){
            $(this).parent().parent().next().find('.embed').slideUp();
        } else {
            $(this).parent().parent().next().find('.embed').slideDown();
        }
    })

    $('.iframe_size_select').change(function(e) {
        var option = $(this).find(":selected").val();
        if(option == "other" && $(this).next().text() == "") {
            $(this).next().append("<input autofocus type=\"number\" min=\"100\" max=\"1000\" step=\"1\" name=\"width\" placeholder=\"width\"'></input> X \
                               <input type=\"number\" min=\"100\" max=\"1000\" step=\"1\" name=\"height\" placeholder=\"height\"'></input> px");
        } else if (option != "other") {
            var size = $(this).find(":selected").text().split("x");
            var width = size[0];
            var height = size[1];
            $(this).next().html("");
            var el_id = "#embed_" + $(this).attr('id');
            var frame_url = $(el_id + ' input').val().split("src='")[1];
            document.querySelector(el_id + ' input').value = "<iframe width='" + width + "' height='" + height + "' src='" + frame_url;
        }
    })

    // function to dynamically fill the embed code with new width and height
    $('.iframe_other_size').on('focusout', 'input', function(event){
        var curr_value = $(this).val();
        var sibling_value = $(this).siblings().val();
        if(!$.isNumeric(curr_value)) {
            curr_value = 100;
        } else if(curr_value < 100) {
            curr_value = 100;
        } else if(curr_value > 1000) {
            curr_value = 1000;
        }
        if(sibling_value != "") {
            if(sibling_value < 100) {
                sibling_value = 100;
            } else if(sibling_value > 1000) {
                sibling_value = 1000;
            }
            var width, height;
            if($(this).attr('name') == "width") {
                width = curr_value;
                height = sibling_value;
            } else {
                width = sibling_value;
                height = curr_value;
            }
            var el_id = "#embed_" + $(this).parent().siblings("select").attr('id');
            var frame_url = $(el_id + ' input').val().split("src='")[1];
            document.querySelector(el_id + ' input').value = "<iframe width='" + width + "' height='" + height + "' src='" + frame_url;
        }
    });

    $("input").on("click", function () {
        $(this).select();
    });

})