= javascript_include_tag '/assets/timelinejs/storyjs-embed.js'

#timeline-embed

:javascript

  //var node = document.createElement("script");
  //$.extend(node, {
  //    type: 'text/javascript',
  //    charset: 'utf-8',
  //    async: false,
  //    defer: true,
  //    src: '/assets/timelinejs/storyjs-embed.js'
  //});
  //
  //$(node).bind('load', function() {
  //})
  //$('#timeline-embed')[0].appendChild(node);

  $(document).on('ready page:change', function() {

    var source = "/widgets/calendar/timelinejs_data/#{calendar.id}/"
    var curr_slide = "#{calendar.events.where(:starts_at.lte => Date.current).count - 1}"

    createStoryJS({
      width:              '100%',
      height:             '600',

      source:             source,

      embed_id:           'timeline-embed',               //OPTIONAL USE A DIFFERENT DIV ID FOR EMBED
      start_at_end:       false,                          //OPTIONAL START AT LATEST DATE
      start_at_slide:     curr_slide, //OPTIONAL START AT SPECIFIC SLIDE
      start_zoom_adjust:  '3',                              //OPTIONAL TWEAK THE DEFAULT ZOOM LEVEL
      hash_bookmark:      false,                           //OPTIONAL LOCATION BAR HASHES
      //font:               'Ubuntu',             //OPTIONAL FONT
      debug:              false,                           //OPTIONAL DEBUG TO CONSOLE
      lang:               window.aHelper.lang(),                           //OPTIONAL LANGUAGE
      maptype:            'watercolor',                   //OPTIONAL MAP STYLE
    })

  })
