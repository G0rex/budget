.sidebar.col-xs-12
  %table#description_table
    %thead
      %tr
        %th
          =t('widgets.visify.sidebar.description')
    %tbody
      %tr
        %td
          #description

  - if file.taxonomy_attachments && file.taxonomy_attachments.length > 0
    %table#attachments_table
      %thead
        %tr
          %th
            =t('widgets.visify.sidebar.attachments')
      %tbody
        - file.taxonomy_attachments.each do |attachment|
          %tr
            %td
              = link_to attachment.attachment.url do
                %i.fa.fa-download.fa-border
                = attachment.title

:javascript

  $(document).ready(function() {
    $('#collapseDesc').on("shown.bs.collapse", function() {
      check_height();
    })
  })

  var height;

  function check_height() {
    if($('#collapseDesc').height() > height) {
      $('#collapseDesc').height(height);
    }
  }

  function aSidebar(aContainer) {
    var chart, pie, table;

    return {
      container: aContainer,

      initialize: function(height, options){
        chart = aSidebarChartBattery('.sidebar')
        chart.initialize(options)

        pie = aSidebarPie('.sidebar')
        pie.initialize(500, options)

        table = aSidebarTable('.sidebar')
        table.initialize(500, options)
      },

      hide: function(){
        //$(aContainer + ' #sidebar #description').html('');

        chart.hide();
        pie.hide();
        table.hide();
      },
      show: function(node){
        this.getLevelInfo(node)
      },

      getLevelInfo: function(node) {

        $.getJSON("/widgets/visify/get_bubbletree_nodedata/#{@budget_file.id}/" + node.taxonomy + "/" + node.key, function(data) {
          div_descr = '';
          $('#collapseDesc').height('auto');
          if (data.description) {
            div_descr = "<div class='description'>" + data.description + "</div>"
            if(!height) { // asign height equal to chart
              height = $('.chart').height();
            }
          }
          $(aContainer + ' #description').html(div_descr)
          check_height();

          if(node.children && node.children.length != 0) {
              chart.show(node.children);
              pie.show(node.children);
              table.show(node.children);
          }
        })
      },
    }
  }