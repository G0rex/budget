-# http://geojson.org/geojson-spec.html#examples
-# http://www.rubydoc.info/gems/rgeo-geojson/frames

-# https://github.com/alexreisner/geocoder
-# http://railscasts.com/episodes/273-geocoder

= stylesheet_link_tag 'leaflet/leaflet.css', :media => 'all'

:css
  #map {
    width: 100%;
    height: 500px;
    margin: 0;
    padding: 0;
  }

=content_for :top do
  #map

= form_tag vtarnay_module8_search_addr_path(@vtarnay_module8), :method => :get, :remote => true, :html => { :class => 'form-vertical' } do |f|
  = text_field_tag :q, '', class: 'form-control'
  = submit_tag 'Search', :class => 'btn btn-primary'



:javascript

  $(document).ready(function() {
    $.when(
      $.getScript( "/assets/leaflet/leaflet.js" ),
      $.Deferred(function( deferred ){
          $( deferred.resolve );
      })
    ).done(function(){

      var map = L.map('map', { scrollWheelZoom : false} ).setView([49.2336, 28.45514], 8)

      window.lmap = map
      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        maxZoom: 17,
        id: 'begemot.mbl2go4k',
        accessToken: 'pk.eyJ1IjoiYmVnZW1vdCIsImEiOiJlMjk1ODk0MDIzOTgxODUxNzFjNDk5YTBhNGNmNjQ3YyJ9.N5HyCJcDWeQGJcqCl1nHVQ'
      }).addTo(map);

      L.Icon.Default.imagePath = '/assets/leaflet/images'


      var marker = L.marker([49.2336, 28.45514], {
        draggable: true,
      }).addTo(map);
      popupContent =  '<div class="popup">' +
        '<h3> + properties.name + </h3>' +
        '<p> + properties.address + </p>' +
        '</div>'

      marker.bindPopup(popupContent).openPopup();


      var popup = L.popup();
      function onMapClick(e) {
          popup
            .setLatLng(e.latlng)
            .setContent("You clicked the map at " + e.latlng.toString())
            .openOn(map);
      }

      map.on('click', onMapClick);
    })

  });
