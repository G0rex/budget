-# http://geojson.org/geojson-spec.html#examples
-# http://www.rubydoc.info/gems/rgeo-geojson/frames

-# https://github.com/alexreisner/geocoder
-# http://railscasts.com/episodes/273-geocoder

= stylesheet_link_tag 'leaflet/leaflet.css', :media => 'all'

:css
  html, body, #map {
    width: 100%;
    height: 900px;
    margin: 0;
    padding: 0;
  }
#map

:javascript

  $(document).ready(function() {
    $.when(
      $.getScript( "/assets/leaflet/leaflet.js" ),
      $.Deferred(function( deferred ){
          $( deferred.resolve );
      })
    ).done(function(){

      var url = 'http://{s}.tile.cloudmade.com/{key}/22677/256/{z}/{x}/{y}.png?access_token={accessToken}',

      var map = L.map('map', 'mapbox.streets', { scrollWheelZoom : false })
        .setView([49.2336, 28.45514], 9);

      L.tileLayer(url, {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        maxZoom: 18,
        id: 'begemot.mbl2go4k',
        accessToken: 'pk.eyJ1IjoiYmVnZW1vdCIsImEiOiJlMjk1ODk0MDIzOTgxODUxNzFjNDk5YTBhNGNmNjQ3YyJ9.N5HyCJcDWeQGJcqCl1nHVQ'
      }).addTo(map);

      L.Icon.Default.imagePath = '/assets/leaflet/images'

      var marker = L.marker([49.2336, 28.45514]).addTo(map);

      var popup = L.popup();
      function onMapClick(e) {
          popup
            .setLatLng(e.latlng)
            .setContent("You clicked the map at " + e.latlng.toString())
            .openOn(map);
      }

      map.on('click', onMapClick);
    })

  });
