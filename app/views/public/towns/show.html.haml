:css
  .budget {
    cursor: pointer;
  }
  .budget.active {
    cursor: default;
    font-weight: bold;
  }


=content_for :header do
  .head.pull-left
    =@town.title

.col-xs-2

  %img.thumbnail{src: @town.img.thumb.url}

  %h3
    Візуалізації

  - @budgets.each do |budget|
    %p
      %h4.budget{ 'data-id' => budget.id, 'data-vis' => 'bubbletree' }
        = budget.title
    %hr

  %h3
    Календарі

  - @calendars.each do |calendar|
    %p
      %h4.calendar{ 'data-id' => calendar.id }
        = calendar.title
    %hr



.col-xs-10
  %iframe#budget{ :style => 'width: 100%; height: 100vh; border: none;' }


:javascript

  $(document).ready(function() {

    $('.budget[data-id]').on('click', function (e) {
      $('.budget[data-id]').removeClass('active')
      $(this).addClass('active')

      var vis = $(this).attr('data-vis')
      var id = $(this).attr('data-id')
      set_iframe(vis, id);
    });

    function set_iframe(vis, id) {
      path = "#{request.base_url}"
      query = "#{URI.parse(request.url).query}"
      frame_url = path + "/widgets/visify/"+ vis + "/" + id + '/?' + query
      $('iframe#budget').attr('src', frame_url)
    }

  })