= javascript_include_tag "biPartite.js"
= javascript_include_tag "sankey.js"

= form_for @sankey do |f|
  - if @sankey.errors.any?
    #error_explanation
      %h2= "#{pluralize(@sankey.errors.count, "error")} prohibited this sankey from being saved:"
      %ul
        - @sankey.errors.full_messages.each do |msg|
          %li= msg

  %select{:class => "selectpicker", :id => "select_rot", :name => :rot_file_id}
    - @budget_files_rot.each do |rot_file|
      %option{:value => rot_file.id}
        = rot_file.title
        = rot_file.taxonomy.owner

  %select{:class => "selectpicker", :id => "select_rov", :name => :rov_file_id}
    - @budget_files_rov.each do |rov_file|
      %option{:value => rov_file.id}
        = rov_file.title
        = rov_file.taxonomy.owner

  %p
  %button{:type => "button", :class => "btn btn-primary", :id => "sankey_create"} Створити візуалізацію

  .budget
    #sankey_chart

  %p
  .actions
    = f.submit 'Зберегти візуалізацію', :class => "btn btn-primary", :id => "sankey_save", :style => "display: none"

:javascript

  $(document).on('ready page:change', function() {

    $('#status_bar').html('');
    $('#sankey_chart').html('').css("height", "0");
    $('#sankey_save').css("display", "none");

    $('#sankey_create').click(function() {

      $('#status_bar').html('');
      $('#sankey_chart').html('').css("height", "0");
      $('#sankey_save').css("display", "none");

      var rot_file_id = $('#select_rot option:selected').val();
      var rov_file_id = $('#select_rov option:selected').val();

      get_sankey(rot_file_id, rov_file_id);
    })

  })
