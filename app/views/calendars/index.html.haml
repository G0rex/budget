- model_class = Calendar
.page-header
  %h1=t '.title', :default => model_class.model_name.human.pluralize.titleize

.col-md-12
  / PAGE CONTENT BEGINS
  .row-fluid
    .col-md-3
      .widget-box.transparent
        .widget-header1
          %h4 Типові дії міської влади
        .widget-main
          #external-events.calendar-event.width-sm
            .external-event.bg-purple.ui-draggable{"data-bg" => "bg-purple", "data-desc" => "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "data-media" => "<i class='fa fa-comments'></i>", "data-title" => "Discussion", :style => "position: relative;"}
              %h5
                %i.fa.fa-comments.fa-lg.fa-fw
                Дискусія......
              %p Lorem ipsum dolor sit amet, consectetur adipiscing elit.
            .external-event.bg-blue.ui-draggable{"data-bg" => "bg-blue", "data-desc" => "<b>Cum sociis</b> natoque penatibus et magnis dis parturient montes.", "data-media" => "<i class='fa fa-cutlery'></i>", "data-title" => "Обговорення", :style => "position: relative;"}
              %h5
                %i.fa.fa-cutlery.fa-lg.fa-fw
                Обговорення
              %p Cum sociis natoque penatibus et magnis dis parturient montes.
            .external-event.bg-blue.ui-draggable{"data-bg" => "bg-blue", "data-desc" => "<b>Cum sociis</b> natoque penatibus et magnis dis parturient montes.", "data-media" => "<i class='fa fa-cutlery'></i>", "data-title" => "Обговорення", :style => "position: relative;"}
              %h5
                %i.fa.fa-cutlery.fa-lg.fa-fw
                Обговорення
              %p Cum sociis natoque penatibus et magnis dis parturient montes.
            .external-event.bg-green.ui-draggable{"data-bg" => "bg-green", "data-desc" => "Mauris tristique massa eu venenatis semper. Phasellus a nibh nisi.", "data-media" => "<i class='fa fa-lightbulb-o'></i>", "data-title" => "Слухання", :style => "position: relative;"}
              %h5
                %i.fa.fa-lightbulb-o.fa-lg.fa-fw
                Слухання
              %p Mauris tristique massa eu venenatis semper. Phasellus a nibh nisi.
            .external-event.bg-orange.ui-draggable{"data-bg" => "bg-orange", "data-desc" => "Class aptent taciti sociosqu ad litora torquent per conubia nostra.", "data-media" => "<i class='fa fa-tasks'></i>", "data-title" => "Performance Rating", :style => "position: relative;"}
              %h5
                %i.fa.fa-tasks.fa-lg.fa-fw
                Performance Rating
              %p Формування звітності про виконання місцевого бюджету за минулий рік. Доведення бюджетного фінансування до розпорядників коштів на поточний рік.
            .external-event.bg-orange.ui-draggable{"data-bg" => "bg-orange", "data-desc" => "Class aptent taciti sociosqu ad litora torquent per conubia nostra.", "data-media" => "<i class='fa fa-tasks'></i>", "data-title" => "Performance Rating", :style => "position: relative;"}
              %h5
                %i.fa.fa-tasks.fa-lg.fa-fw
                Performance Rating
              %p Формування звітності про виконання місцевого бюджету за минулий рік. Доведення бюджетного фінансування до розпорядників коштів на поточний рік.
    .col-md-7
      .space
      #calendar
    .col-md-2
      .widget-box.transparent
        .widget-header1
          %h4 Типові дії громадських активістів
        .widget-main
          #external-events.calendar-event.width-sm
            .external-event.bg-purple.ui-draggable{"data-bg" => "bg-purple", "data-desc" => "Lorem ipsum dolor sit amet, consectetur adipiscing elit.", "data-media" => "<i class='fa fa-comments'></i>", "data-title" => "Discussion", :style => "position: relative;"}
              %h5
                %i.fa.fa-comments.fa-lg.fa-fw
                Діскусія......
              %p Lorem ipsum dolor sit amet, consectetur adipiscing elit.
            .external-event.bg-blue.ui-draggable{"data-bg" => "bg-blue", "data-desc" => "Cum sociis natoque penatibus et magnis dis parturient montes.", "data-media" => "<i class='fa fa-cutlery'></i>", "data-title" => "Обговорення", :style => "position: relative;"}
              %h5
                %i.fa.fa-cutlery.fa-lg.fa-fw
                Обговорення
              %p Cum sociis natoque penatibus et magnis dis parturient montes.
            .external-event.bg-green.ui-draggable{"data-bg" => "bg-green", "data-desc" => "Mauris tristique massa eu venenatis semper. Phasellus a nibh nisi.", "data-media" => "<i class='fa fa-lightbulb-o'></i>", "data-title" => "Слухання", :style => "position: relative;"}
              %h5
                %i.fa.fa-lightbulb-o.fa-lg.fa-fw
                Слухання
              %p Mauris tristique massa eu venenatis semper. Phasellus a nibh nisi.
            .external-event.bg-green.ui-draggable{"data-bg" => "bg-green", "data-desc" => "Mauris tristique massa eu venenatis semper. Phasellus a nibh nisi.", "data-media" => "<i class='fa fa-lightbulb-o'></i>", "data-title" => "Слухання", :style => "position: relative;"}
              %h5
                %i.fa.fa-lightbulb-o.fa-lg.fa-fw
                Слухання
              %p Mauris tristique massa eu venenatis semper. Phasellus a nibh nisi.
            .external-event.bg-orange.ui-draggable{"data-bg" => "bg-orange", "data-desc" => "Class aptent taciti sociosqu ad litora torquent per conubia nostra.", "data-media" => "<i class='fa fa-tasks'></i>", "data-title" => "Performance Rating", :style => "position: relative;"}
              %h5
                %i.fa.fa-tasks.fa-lg.fa-fw
                Performance Rating
              %p Class aptent taciti sociosqu ad litora torquent per conubia nostra.


%table.table.table-striped
  %thead
    %tr
      %th= model_class.human_attribute_name(:id)
      %th= model_class.human_attribute_name(:dt_start)
      %th= model_class.human_attribute_name(:dt_end)
      %th= model_class.human_attribute_name(:title)
      %th= model_class.human_attribute_name(:body)
      %th=t '.actions', :default => t("helpers.actions")
  %tbody
    - @calendars.each do |calendar|
      %tr
        %td= link_to calendar.id, calendar_path(calendar)
        %td= calendar.dt_start
        %td= calendar.dt_end
        %td= calendar.title
        %td= calendar.body
        %td
          = link_to t('.edit', :default => t("helpers.links.edit")), edit_calendar_path(calendar), :class => 'btn btn-default btn-xs'
          = link_to t('.destroy', :default => t("helpers.links.destroy")), calendar_path(calendar), :method => :delete, :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) }, :class => 'btn btn-xs btn-danger'

= link_to t('.new', :default => t("helpers.links.new")), new_calendar_path, :class => 'btn btn-primary'



:javascript
  $(function() {

  /* initialize the external events
  -----------------------------------------------------------------*/

    $('#external-events div.external-event').each(function() {
        var eventObject = {
          title: $.trim($(this).attr("data-title")),
          className: $(this).attr("data-bg"),
          media: $(this).attr("data-media"),
          description: $(this).attr("data-desc")};

        $(this).data("eventObject", eventObject);
        $(this).draggable({ zIndex: 999, revert: true, revertDuration: 0 })
    });

    /* initialize the calendar
      -----------------------------------------------------------------*/

    var date = new Date();
    var d = date.getDate();
    var m = date.getMonth();
    var y = date.getFullYear();

    var calendar = $('#calendar').fullCalendar({
        events: [
          {
            title: "Дія 1 ", start: new Date(y, m, 0), end: new Date(y, m, 1), className: "bg-purple", media: '<i class="fa fa-trophy"></i>', description: "Опис дії................................"
          },
          {
            title: "Загальні збори", start: new Date(y, m, 10), end: new Date(y, m, 12), allDay: false, className: "bg-blue", media: '<i class="fa fa-users"></i>', description: "Lorem ipsum dolor sit amet adipiscing elit."
          },
          {
            title: 'Дооооооооовга дія ;)',
            start: new Date(y, m, d-1),
            end: new Date(y, m, d),
            className: 'label-success',
            allDay: true
          },
        ],
        header: {
          left: 'prev,next today',
          center: 'title',
          right: 'month,agendaWeek,agendaDay'
        },
        lang: 'uk',
        editable: true,

        droppable: true, // this allows things to be dropped onto the calendar !!!
        drop: function(date, allDay) { // this function is called when something is dropped
          var n = $(this).data("eventObject");
          var r = $.extend({}, n);
          r.start = date;
          r.allDay = allDay;
          $("#calendar").fullCalendar("renderEvent", r, true);

        },
        selectable: true,
        selectHelper: true,
        select: function(start, end, allDay) {
          bootbox.prompt("Нова дія:", function(title) {
              if (title !== null) {
                  calendar.fullCalendar('renderEvent',
                  {
                      title: title,
                      start: start,
                      end: end,
                      allDay: allDay
                  },
                      true // make the event "stick"
                      );
              }
          });
          calendar.fullCalendar('unselect');

        },
        eventClick: function(calEvent, jsEvent, view) {
          var form = $("<form class='form-inline'><label>Назва дії &nbsp;</label></form>");
          form.append("<label>" + calEvent.title + "</label> ");

          var div = bootbox.dialog(form, [
            {
                "label" : "<i class='icon-remove'></i> Закрити",
                "class" : "btn-small"
            }],
            {
                // prompts need a few extra options
                "onEscape": function(){div.modal("hide");}
            }
          );

          form.on('submit', function(){
            calEvent.title = form.find("input[type=text]").val();
            calendar.fullCalendar('updateEvent', calEvent);
            div.modal("hide");
            return false;
          });
        },
        eventRender: function (e, t, n) {
          var r = e.media ? e.media : "";
          var i = e.description ? e.description : "";

          t.find(".fc-event-title").before($('<span class="fc-event-icons"></span>').html(r));
          t.find(".fc-event-title").append("<br><small data-toggle='tooltip' data-placement='top' title='Tooltip'>" + i + "</small>")
        }

      });


  })
